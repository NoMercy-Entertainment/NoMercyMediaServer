using NoMercy.Database.Models.Media;

namespace NoMercy.Tests.Database;

public class MetadataTests
{
    [Fact]
    public async Task CalculateTotalSize_ReturnsCorrectSize()
    {
        Metadata metadata = new()
        {
            Id = new(),
            Video =
            [
                new() { FileSize = 500 },
                new() { FileSize = 700 }
            ],
            Audio =
            [
                new() { FileSize = 300 },
                new() { FileSize = 400 }
            ],
            Subtitles =
            [
                new() { FileSize = 50 },
                new() { FileSize = 70 }
            ],
            Previews =
            [
                new() { ImageFileSize = 30, TimeFileSize = 20 },
                new() { ImageFileSize = 40, TimeFileSize = 25 }
            ],
            Fonts =
            [
                new() { FileSize = 15 },
                new() { FileSize = 25 }
            ],
            FontsFile = new() { FileSize = 100 }
        };

        long expectedTotalSize =
            500 + 700 // Video sizes
                + 300 + 400 // Audio sizes
                + 50 + 70 + // Subtitle sizes
                30 + 20 + 40 + 25 + // Preview sizes
                15 + 25 + // Font sizes
                100; // FontsFile size

        // Act
        long totalSize = metadata.CalculateTotalSize();

        // Assert
        Assert.Equal(expectedTotalSize, totalSize);

        await Task.CompletedTask;
    }

    [Fact]
    public async Task CalculateTotalSize_WithChapterFile_ReturnsCorrectSize()
    {
        Metadata metadata = new()
        {
            Id = new(),
            Video =
            [
                new() { FileSize = 500 },
                new() { FileSize = 700 }
            ],
            Audio =
            [
                new() { FileSize = 300 },
                new() { FileSize = 400 }
            ],
            Subtitles =
            [
                new() { FileSize = 50 },
                new() { FileSize = 70 }
            ],
            Previews =
            [
                new() { ImageFileSize = 30, TimeFileSize = 20 },
                new() { ImageFileSize = 40, TimeFileSize = 25 }
            ],
            Fonts =
            [
                new() { FileSize = 15 },
                new() { FileSize = 25 }
            ],
            FontsFile = new() { FileSize = 100 },
            ChapterFile = new() { FileSize = 200 }
        };

        long expectedTotalSize =
            500 + 700 // Video sizes
                + 300 + 400 // Audio sizes
                + 50 + 70 + // Subtitle sizes
                30 + 20 + 40 + 25 + // Preview sizes
                15 + 25 + // Font sizes
                100 + // FontsFile size
                200; // ChapterFile size

        // Act
        long totalSize = metadata.CalculateTotalSize();

        // Assert
        Assert.Equal(expectedTotalSize, totalSize);

        await Task.CompletedTask;
    }
}