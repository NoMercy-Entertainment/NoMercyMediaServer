using Microsoft.EntityFrameworkCore;
using NoMercy.Database;
using NoMercy.Database.Models;
using NoMercy.Queue.system;

namespace NoMercy.Server.app.Jobs;

public class AddShowsJob : IShouldQueue
{
    public AddShowsJob()
    {
    }

    public async Task Handle()
    {
        int[] animeIds =
        [
            44310, 30980, 90546, 30977, 122587, 74092, 77778, 75777, 912, 130237, 65292, 70637, 61259, 72519, 42942,
            74080, 42589, 63088, 45348, 62110, 77529, 203780, 61695, 70716, 50712, 73223, 12598, 38464, 99083, 212963,
            65931, 102086, 138357, 83962, 71024, 93256, 80671, 114410, 63145, 73017, 37527, 72528, 76063, 72517, 70636,
            31724, 100567, 30991, 72503, 45859, 46004, 76122, 85937, 12577, 75208, 60810, 42410, 54930, 31682, 42671,
            196040, 46261, 196285, 90677, 62273, 61456, 39379, 72426, 231677, 63453, 34793, 76757, 79166, 31731, 60730,
            60863, 34749, 80665, 45950, 56998, 110070, 46298, 40178, 71007, 82738, 119335, 46025, 40424, 62745, 68080,
            74096, 42253, 45799, 72305, 83054, 46374, 37585, 74097, 45998, 72635, 60831, 66080, 53715, 69293, 72026,
            72636, 72788, 60732, 69291, 21732, 21730, 46195, 139287, 72296, 65930, 62565, 77723, 95317, 890, 62640,
            60808, 64710, 29117, 69298, 64196, 77701, 22254, 19780, 20177, 60572, 43865, 45502, 42510, 74163, 113687,
            96316, 60845, 42444, 62742, 28061, 34805, 1087, 71018, 26707, 45844, 42509, 78102, 26563, 117933, 45782,
            78204, 72525, 75975, 114937, 48561, 66077, 68639, 53347, 64671, 45997, 67676, 62430, 80670, 50325, 78471,
            76719, 83095, 62104, 64163, 56351, 34742, 205308, 68101, 127714, 66926, 75214, 64414, 86836, 85844, 45967,
            61663, 80504, 83105,
        ];

        await using MediaContext context = new MediaContext();

        Library? animeLibrary = await context.Libraries
            .Include(l => l.FolderLibraries)
            .ThenInclude(fl => fl.Folder)
            .Where(f => f.Title == "Anime")
            .FirstOrDefaultAsync();

        if (animeLibrary is not null)
        {
            foreach (var id in animeIds)
            {
                AddShowJob addShowJob = new AddShowJob(id:id, libraryId:animeLibrary.Id.ToString());
                JobDispatcher.Dispatch(addShowJob, "queue", 5);
            }
        }

        
        int[] tvIds =
        [
            39340, 1973, 75219, 75123, 64537, 1433, 246, 41727, 82728, 153657, 95, 66840, 74728, 66912, 87108, 44006,
            58841, 1615, 1404, 58474, 67026, 86824, 1405, 4229, 131927, 73021, 6326, 720, 122226, 1415, 1434, 87917,
            1668, 124364, 615, 1399, 70128, 1126, 88329, 88987, 1408, 19716, 1425, 1100, 232125, 158307, 2345, 70593,
            2384, 8358, 84958, 86831, 63174, 39483, 85324, 83043, 114695, 102693, 61550, 1403, 69088, 73919, 59427,
            66190, 61889, 63181, 133903, 40044, 68716, 62127, 38472, 62126, 111312, 92788, 70784, 67466, 72705, 62285,
            67178, 92749, 81358, 62560, 92782, 2317, 1428, 4614, 124271, 17610, 61387, 80350, 92830, 39272, 2632, 64394,
            56570, 1877, 8392, 62816, 60625, 71790, 71789, 6005, 64434, 114472, 61664, 92783, 66857, 50825, 37680,
            100414, 195819, 48866, 40546, 1481, 1418, 46952, 68018, 15632, 81046, 95205, 88396, 1996, 69629, 71712,
            72844, 2362, 100088, 33880, 118663, 82856, 5920, 61367, 15621, 79744, 90802, 456, 47640, 68590, 4429, 46331,
            137, 85271, 117821, 119051, 128010, 63247, 91363, 71728, 60866,
        ];
        
        Library? seriesLibrary = await context.Libraries
            .Include(l => l.FolderLibraries)
            .ThenInclude(fl => fl.Folder)
            .Where(f => f.Title == "Series")
            .FirstOrDefaultAsync();

        if (seriesLibrary is not null)
        {
            foreach (var id in tvIds)
            {
                AddShowJob addShowJob = new AddShowJob(id:id, libraryId:seriesLibrary.Id.ToString());
                JobDispatcher.Dispatch(addShowJob, "queue", 5);
            }
        }
        
    }
}