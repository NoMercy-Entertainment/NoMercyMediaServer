<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:NoMercy.Tray.ViewModels"
        xmlns:m="using:NoMercy.Tray.Models"
        x:Class="NoMercy.Tray.Views.LogViewerWindow"
        x:DataType="vm:LogViewerViewModel"
        Title="NoMercy - Log Viewer"
        Width="960" Height="640"
        MinWidth="640" MinHeight="400"
        WindowStartupLocation="CenterScreen">

    <Window.Styles>
        <Style Selector="ListBoxItem">
            <Setter Property="Padding" Value="0" />
            <Setter Property="Margin" Value="0" />
            <Setter Property="MinHeight" Value="24" />
        </Style>
    </Window.Styles>

    <DockPanel Margin="8">
        <!-- Toolbar -->
        <StackPanel DockPanel.Dock="Top"
                    Orientation="Horizontal"
                    Spacing="8"
                    Margin="0,0,0,8">
            <TextBox x:Name="SearchBox"
                     Watermark="Search logs..."
                     Width="250"
                     Text="{Binding SearchText}" />

            <ComboBox x:Name="LevelCombo"
                      Width="130"
                      ItemsSource="{Binding LevelOptions}"
                      SelectedItem="{Binding SelectedLevel}" />

            <ComboBox x:Name="TailCombo"
                      Width="90"
                      ItemsSource="{Binding TailOptions}"
                      SelectedItem="{Binding TailCount}" />

            <CheckBox Content="Auto-refresh"
                      IsChecked="{Binding AutoRefresh}"
                      VerticalAlignment="Center" />

            <Button Content="Refresh"
                    Click="OnRefreshClick" />

            <Button Content="Clear Filters"
                    Click="OnClearFiltersClick" />
        </StackPanel>

        <!-- Column headers -->
        <Grid DockPanel.Dock="Top"
              Margin="0,0,0,2"
              ColumnDefinitions="100,80,110,*,55">
            <TextBlock Grid.Column="0" Text="Time"
                       FontWeight="SemiBold" FontSize="12"
                       Foreground="#9CA3AF" Margin="6,2" />
            <TextBlock Grid.Column="1" Text="Level"
                       FontWeight="SemiBold" FontSize="12"
                       Foreground="#9CA3AF" Margin="4,2" />
            <TextBlock Grid.Column="2" Text="Type"
                       FontWeight="SemiBold" FontSize="12"
                       Foreground="#9CA3AF" Margin="4,2" />
            <TextBlock Grid.Column="3" Text="Message"
                       FontWeight="SemiBold" FontSize="12"
                       Foreground="#9CA3AF" Margin="4,2" />
            <TextBlock Grid.Column="4" Text="Thread"
                       FontWeight="SemiBold" FontSize="12"
                       Foreground="#9CA3AF" Margin="4,2" />
        </Grid>

        <!-- Status bar -->
        <StackPanel DockPanel.Dock="Bottom"
                    Orientation="Horizontal"
                    Margin="0,4,0,0">
            <TextBlock Text="{Binding StatusText}"
                       VerticalAlignment="Center"
                       Foreground="#9CA3AF"
                       FontSize="12" />
        </StackPanel>

        <!-- Log entries -->
        <ListBox x:Name="LogList"
                 ItemsSource="{Binding FilteredEntries}"
                 SelectionMode="Single"
                 BorderThickness="1"
                 BorderBrush="#374151"
                 Background="#111827">
            <ListBox.ItemTemplate>
                <DataTemplate x:DataType="m:LogEntryResponse">
                    <Grid ColumnDefinitions="100,80,110,*,55"
                          Margin="0,1">
                        <TextBlock Grid.Column="0"
                                   Text="{Binding Time, StringFormat={}{0:HH:mm:ss.fff}}"
                                   FontFamily="Cascadia Mono, Consolas, monospace"
                                   FontSize="12"
                                   Foreground="#9CA3AF"
                                   Margin="6,0"
                                   VerticalAlignment="Center" />
                        <TextBlock Grid.Column="1"
                                   Text="{Binding Level}"
                                   FontFamily="Cascadia Mono, Consolas, monospace"
                                   FontSize="12"
                                   Foreground="{Binding Level, Converter={x:Static vm:LevelColorConverter.Instance}}"
                                   FontWeight="{Binding Level, Converter={x:Static vm:LevelWeightConverter.Instance}}"
                                   Margin="4,0"
                                   VerticalAlignment="Center" />
                        <TextBlock Grid.Column="2"
                                   Text="{Binding Type}"
                                   FontFamily="Cascadia Mono, Consolas, monospace"
                                   FontSize="12"
                                   Foreground="#60A5FA"
                                   Margin="4,0"
                                   VerticalAlignment="Center" />
                        <TextBlock Grid.Column="3"
                                   Text="{Binding Message}"
                                   FontFamily="Cascadia Mono, Consolas, monospace"
                                   FontSize="12"
                                   Foreground="#D1D5DB"
                                   TextTrimming="CharacterEllipsis"
                                   Margin="4,0"
                                   VerticalAlignment="Center" />
                        <TextBlock Grid.Column="4"
                                   Text="{Binding ThreadId}"
                                   FontFamily="Cascadia Mono, Consolas, monospace"
                                   FontSize="12"
                                   Foreground="#6B7280"
                                   Margin="4,0"
                                   VerticalAlignment="Center" />
                    </Grid>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
    </DockPanel>
</Window>
